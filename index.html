<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Tax Refund Estimator 2024</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Simple step transition */
    .step { display: none; }
    .step.active { display: block; }
  </style>
</head>
<body class="bg-gray-100">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">Advanced Tax Refund Estimator 2024</h1>
    
    <!-- Progress Indicator -->
    <div id="progressIndicator" class="flex justify-between mb-6">
      <div class="step-indicator text-xs text-gray-700" data-step="0">1. Filing Info</div>
      <div class="step-indicator text-xs text-gray-700" data-step="1">2. Income & Deductions</div>
      <div class="step-indicator text-xs text-gray-700" data-step="2">3. Withholdings & Taxes</div>
      <div class="step-indicator text-xs text-gray-700" data-step="3">4. AMT Details</div>
      <div class="step-indicator text-xs text-gray-700" data-step="4">5. Recommendations</div>
      <div class="step-indicator text-xs text-gray-700" data-step="5">6. Summary</div>
    </div>
    
    <!-- Multi-Step Form -->
    <form id="taxForm" class="bg-white shadow rounded p-6">
      
      <!-- Step 1: Filing Information -->
      <div class="step active" data-step="0">
        <h2 class="text-xl font-semibold mb-4">Step 1: Filing Information</h2>
        <div class="mb-4">
          <label for="filingStatus" class="block text-sm font-medium text-gray-700">
            Filing Status
            <span class="text-blue-500 cursor-help" title="Select your filing status: Single, Married Filing Jointly, Married Filing Separately, or Head of Household.">?</span>
          </label>
          <select id="filingStatus" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
            <option value="single">Single</option>
            <option value="mfj">Married Filing Jointly</option>
            <option value="mfs">Married Filing Separately</option>
            <option value="hoh">Head of Household</option>
          </select>
        </div>
        <div class="mb-4">
          <label for="stateSelect" class="block text-sm font-medium text-gray-700">
            State of Residence
            <span class="text-blue-500 cursor-help" title="Select your state for state tax calculations.">?</span>
          </label>
          <select id="stateSelect" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
            <option value="">Select a state</option>
            <!-- All 50 states -->
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 2: Income & Deductions -->
      <div class="step" data-step="1">
        <h2 class="text-xl font-semibold mb-4">Step 2: Income & Deductions</h2>
        <div class="mb-4">
          <label for="income" class="block text-sm font-medium text-gray-700">
            Total Income ($)
            <span class="text-blue-500 cursor-help" title="Enter your total income before taxes (wages, salaries, tips, etc.).">?</span>
          </label>
          <input type="number" id="income" placeholder="e.g., 50000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div class="mb-4">
          <label for="deductions" class="block text-sm font-medium text-gray-700">
            Total Deductions ($)
            <span class="text-blue-500 cursor-help" title="Enter your total deductions (either standard or itemized).">?</span>
          </label>
          <input type="number" id="deductions" placeholder="e.g., 12000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
          <p class="text-xs text-gray-500 mt-1">If unsure, the standard deduction for 2024 will be used based on filing status.</p>
        </div>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 3: Withholdings & Additional Taxes -->
      <div class="step" data-step="2">
        <h2 class="text-xl font-semibold mb-4">Step 3: Withholdings & Additional Taxes</h2>
        <div class="mb-4">
          <label for="withholdings" class="block text-sm font-medium text-gray-700">
            Federal Tax Withholdings ($)
            <span class="text-blue-500 cursor-help" title="Enter the total federal tax withheld from your paychecks.">?</span>
          </label>
          <input type="number" id="withholdings" placeholder="e.g., 6000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div class="mb-4">
          <label for="socialTax" class="block text-sm font-medium text-gray-700">
            Social Security & Medicare Taxes ($)
            <span class="text-blue-500 cursor-help" title="Enter your Social Security & Medicare taxes if available. If blank, the estimator will calculate them.">?</span>
          </label>
          <input type="number" id="socialTax" placeholder="e.g., 4000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 4: Alternative Minimum Tax (AMT) -->
      <div class="step" data-step="3">
        <h2 class="text-xl font-semibold mb-4">Step 4: Alternative Minimum Tax (AMT)</h2>
        <div class="mb-4">
          <label for="amtIncome" class="block text-sm font-medium text-gray-700">
            AMT Adjusted Income ($)
            <span class="text-blue-500 cursor-help" title="If you have AMT adjustments, enter your AMT adjusted income. Otherwise, leave blank.">?</span>
          </label>
          <input type="number" id="amtIncome" placeholder="e.g., 50000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <p class="text-xs text-gray-500 mb-4">If youâ€™re not subject to AMT, you can leave this blank.</p>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 5: Smart Recommendations -->
      <div class="step" data-step="4">
        <h2 class="text-xl font-semibold mb-4">Step 5: Smart Recommendations</h2>
        <p class="text-sm text-gray-700 mb-4">
          Based on the information provided, we will suggest potential credits and deductions you may be eligible for.
        </p>
        <div id="recommendations" class="p-4 bg-gray-50 rounded border border-dashed border-gray-300 text-sm text-gray-600">
          <!-- Dynamic recommendations will appear here -->
          <em>Your recommendations will appear here after you click "Next."</em>
        </div>
        <div class="flex justify-between mt-4">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 6: Summary & Actions -->
      <div class="step" data-step="5">
        <h2 class="text-xl font-semibold mb-4">Step 6: Summary & Actions</h2>
        <div id="taxSummary" class="p-4 bg-gray-50 rounded border border-gray-300 text-gray-700">
          <p>Please review your details and the calculated summary below.</p>
        </div>
        <div class="mt-4 flex flex-col sm:flex-row sm:justify-end gap-2">
          <button type="button" id="printBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Print Summary</button>
          <button type="button" id="exportBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Export Data</button>
        </div>
        <div class="flex justify-start mt-4">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
        </div>
      </div>
      
    </form>
    
    <!-- Disclaimer -->
    <div class="mt-6 text-sm text-gray-600">
      <p>Disclaimer: This estimator is for informational purposes only. Always consult a tax professional for official advice.</p>
      <p class="mt-2 text-red-600 font-bold">Warning: Ensure accuracy to avoid common IRS audit risks.</p>
    </div>
  </div>

  <script>
    // ---------- Data & Configuration ----------

    // Standard Deductions for 2024 (for demonstration)
    const standardDeductions = {
      single: 13850,
      mfj: 27700,
      mfs: 13850,
      hoh: 20800
    };

    // Federal Tax Brackets for 2024 (Simplified Example)
    const federalTaxBrackets = {
      single: [
        { rate: 0.10, cap: 11000 },
        { rate: 0.12, cap: 44725 },
        { rate: 0.22, cap: 95375 },
        { rate: 0.24, cap: 182100 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 578125 },
        { rate: 0.37, cap: Infinity }
      ],
      mfj: [
        { rate: 0.10, cap: 22000 },
        { rate: 0.12, cap: 89450 },
        { rate: 0.22, cap: 190750 },
        { rate: 0.24, cap: 364200 },
        { rate: 0.32, cap: 462500 },
        { rate: 0.35, cap: 693750 },
        { rate: 0.37, cap: Infinity }
      ],
      mfs: [
        { rate: 0.10, cap: 11000 },
        { rate: 0.12, cap: 44725 },
        { rate: 0.22, cap: 95375 },
        { rate: 0.24, cap: 182100 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 346875 },
        { rate: 0.37, cap: Infinity }
      ],
      hoh: [
        { rate: 0.10, cap: 15700 },
        { rate: 0.12, cap: 59850 },
        { rate: 0.22, cap: 95350 },
        { rate: 0.24, cap: 176250 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 578100 },
        { rate: 0.37, cap: Infinity }
      ]
    };

    // Simplified Flat-State Tax Rates (for demonstration; real rates may be progressive)
    const stateTaxRates = {
      AL: 0.05,
      AK: 0.00,
      AZ: 0.045,
      AR: 0.065,
      CA: 0.09,
      CO: 0.0463,
      CT: 0.0699,
      DE: 0.066,
      FL: 0.00,
      GA: 0.0575,
      HI: 0.08,
      ID: 0.069,
      IL: 0.05,
      IN: 0.0323,
      IA: 0.085,
      KS: 0.057,
      KY: 0.05,
      LA: 0.06,
      ME: 0.0715,
      MD: 0.0575,
      MA: 0.05,
      MI: 0.0425,
      MN: 0.0785,
      MS: 0.05,
      MO: 0.054,
      MT: 0.06,
      NE: 0.0684,
      NV: 0.00,
      NH: 0.05, // Interest & dividends only
      NJ: 0.0637,
      NM: 0.049,
      NY: 0.0685,
      NC: 0.0525,
      ND: 0.022,
      OH: 0.04997,
      OK: 0.05,
      OR: 0.09,
      PA: 0.0307,
      RI: 0.0599,
      SC: 0.07,
      SD: 0.00,
      TN: 0.00,
      TX: 0.00,
      UT: 0.0495,
      VT: 0.08,
      VA: 0.0575,
      WA: 0.00,
      WV: 0.065,
      WI: 0.0765,
      WY: 0.00
    };

    // ---------- Multi-Step Form Navigation ----------
    const steps = document.querySelectorAll('.step');
    const indicators = document.querySelectorAll('.step-indicator');
    let currentStep = 0;

    document.querySelectorAll('.nextBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (currentStep < steps.length - 1) {
          currentStep++;
          updateSteps();
          if (currentStep === 4) {
            // Update recommendations when entering step 5.
            updateRecommendations();
          }
          if (currentStep === 5) {
            // Calculate summary when entering final step.
            updateCalculations();
          }
        }
      });
    });

    document.querySelectorAll('.prevBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (currentStep > 0) {
          currentStep--;
          updateSteps();
        }
      });
    });

    function updateSteps() {
      steps.forEach((step, index) => {
        step.classList.toggle('active', index === currentStep);
      });
      indicators.forEach((ind, index) => {
        ind.classList.toggle('font-bold', index === currentStep);
      });
    }

    // ---------- Calculation Functions ----------

    // Calculate Federal Tax using progressive brackets.
    function calculateFederalTax(taxableIncome, status) {
      const brackets = federalTaxBrackets[status];
      let tax = 0;
      let previousCap = 0;
      for (const bracket of brackets) {
        if (taxableIncome > bracket.cap) {
          tax += (bracket.cap - previousCap) * bracket.rate;
          previousCap = bracket.cap;
        } else {
          tax += (taxableIncome - previousCap) * bracket.rate;
          break;
        }
      }
      return tax;
    }

    // Calculate AMT tax (simplified example).
    function calculateAMT(amtIncome) {
      // 26% on the first $220,700; 28% thereafter.
      if (amtIncome <= 220700) {
        return amtIncome * 0.26;
      } else {
        return (220700 * 0.26) + ((amtIncome - 220700) * 0.28);
      }
    }

    // Calculate Social Security & Medicare Taxes (FICA).
    function calculateFICA(income) {
      const socialSecurityWageBase = 160200; // 2024 wage base.
      const socialSecurityTax = Math.min(income, socialSecurityWageBase) * 0.062;
      const medicareTax = income * 0.0145;
      return socialSecurityTax + medicareTax;
    }

    // Provide smart recommendations based on input.
    function updateRecommendations() {
      const income = parseFloat(document.getElementById('income').value) || 0;
      const deductions = parseFloat(document.getElementById('deductions').value) || 0;
      const filingStatus = document.getElementById('filingStatus').value;
      const recDiv = document.getElementById('recommendations');
      let recommendations = [];

      // Example recommendation: Check if using standard vs. itemized deduction.
      const standard = standardDeductions[filingStatus] || 0;
      if (deductions < standard) {
        recommendations.push(`You may consider taking the standard deduction of $${standard} rather than itemizing.`);
      } else {
        recommendations.push("Your itemized deductions appear to exceed the standard deduction.");
      }

      // Earned Income Credit recommendation (simplified criteria)
      if (income < 50000 && filingStatus === 'single') {
        recommendations.push("You might be eligible for the Earned Income Tax Credit.");
      }

      // Child Tax Credit hint (this is an example; real criteria will be more detailed)
      recommendations.push("Review eligibility for the Child Tax Credit if you have qualifying dependents.");

      // Additional audit risk warning if deductions are unusually high.
      if (deductions > income * 0.8) {
        recommendations.push("<span class='text-red-600 font-bold'>Audit Risk Warning:</span> Your deductions are very high relative to your income. Double-check your entries.");
      }

      recDiv.innerHTML = recommendations.map(rec => `<p>${rec}</p>`).join('');
    }

    // Main calculation to update the summary.
    function updateCalculations() {
      const filingStatus = document.getElementById('filingStatus').value;
      const income = parseFloat(document.getElementById('income').value) || 0;
      let deductions = parseFloat(document.getElementById('deductions').value);
      const withholdings = parseFloat(document.getElementById('withholdings').value) || 0;
      const socialTaxInput = parseFloat(document.getElementById('socialTax').value) || 0;
      const amtIncome = parseFloat(document.getElementById('amtIncome').value) || 0;
      const state = document.getElementById('stateSelect').value;

      // If no itemized deductions provided, use standard deduction.
      if (!deductions || deductions < 1) {
        deductions = standardDeductions[filingStatus] || 0;
      }

      // Calculate taxable income (simplified).
      const taxableIncome = Math.max(income - deductions, 0);
      const federalTax = calculateFederalTax(taxableIncome, filingStatus);
      const amtTax = amtIncome > 0 ? calculateAMT(amtIncome) : 0;
      // Use higher of regular tax and AMT.
      const totalFederalTax = Math.max(federalTax, amtTax);
      // FICA calculation.
      const ficaTax = socialTaxInput || calculateFICA(income);
      // State tax (using a flat rate from our simplified list).
      let stateTax = 0;
      if (state && stateTaxRates.hasOwnProperty(state)) {
        stateTax = taxableIncome * stateTaxRates[state];
      }

      const totalTaxLiability = totalFederalTax + stateTax + ficaTax;
      const refundOrOwed = withholdings - totalTaxLiability;

      // Build summary with visual indicators.
      let summaryHTML = `<p><strong>Taxable Income:</strong> $${taxableIncome.toFixed(2)}</p>`;
      summaryHTML += `<p><strong>Federal Tax:</strong> $${federalTax.toFixed(2)}</p>`;
      if (amtTax > federalTax) {
        summaryHTML += `<p class="text-orange-600"><strong>AMT Applied:</strong> $${amtTax.toFixed(2)}</p>`;
      }
      summaryHTML += `<p><strong>State Tax:</strong> $${stateTax.toFixed(2)}</p>`;
      summaryHTML += `<p><strong>Social Security & Medicare Taxes:</strong> $${ficaTax.toFixed(2)}</p>`;
      summaryHTML += `<p class="mt-2 border-t pt-2"><strong>Total Tax Liability:</strong> $${totalTaxLiability.toFixed(2)}</p>`;
      
      if (refundOrOwed >= 0) {
        summaryHTML += `<p class="mt-2 text-green-600 font-bold">Expected Refund: $${refundOrOwed.toFixed(2)}</p>`;
      } else {
        summaryHTML += `<p class="mt-2 text-red-600 font-bold">Tax Owed: $${Math.abs(refundOrOwed).toFixed(2)}</p>`;
      }
      
      document.getElementById('taxSummary').innerHTML = summaryHTML;
    }

    // ---------- Real-Time Update Event Listeners ----------
    // For inputs that affect calculations, update as the user types.
    document.querySelectorAll('#taxForm input, #taxForm select').forEach(el => {
      el.addEventListener('input', () => {
        // Only update summary if on the final step.
        if (currentStep === 5) updateCalculations();
      });
      el.addEventListener('change', () => {
        if (currentStep === 5) updateCalculations();
      });
    });

    // ---------- Print and Export Functionality ----------
    document.getElementById('printBtn').addEventListener('click', () => {
      window.print();
    });

    document.getElementById('exportBtn').addEventListener('click', () => {
      const data = {
        filingStatus: document.getElementById('filingStatus').value,
        state: document.getElementById('stateSelect').value,
        income: document.getElementById('income').value,
        deductions: document.getElementById('deductions').value,
        withholdings: document.getElementById('withholdings').value,
        socialTax: document.getElementById('socialTax').value,
        amtIncome: document.getElementById('amtIncome').value
      };
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
      const dlAnchorElem = document.createElement('a');
      dlAnchorElem.setAttribute("href", dataStr);
      dlAnchorElem.setAttribute("download", "tax_data.json");
      dlAnchorElem.click();
    });
  </script>
</body>
</html>
