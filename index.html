<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Intelligent Tax Refund Estimator 2024</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Hide steps by default */
    .step { display: none; }
    .step.active { display: block; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">Advanced Tax Refund Estimator 2024</h1>
    
    <!-- Progress Indicator -->
    <div id="progressIndicator" class="flex justify-between mb-6">
      <div class="step-indicator text-xs text-gray-700" data-step="0">1. Filing Info</div>
      <div class="step-indicator text-xs text-gray-700" data-step="1">2. Income & OCR</div>
      <div class="step-indicator text-xs text-gray-700" data-step="2">3. Withholdings & Dependents</div>
      <div class="step-indicator text-xs text-gray-700" data-step="3">4. AMT & SE Tax</div>
      <div class="step-indicator text-xs text-gray-700" data-step="4">5. Projections & Tips</div>
      <div class="step-indicator text-xs text-gray-700" data-step="5">6. Summary</div>
    </div>
    
    <!-- Multi-Step Form -->
    <form id="taxForm" class="bg-white shadow rounded p-6 space-y-6">
      
      <!-- Step 1: Filing Information & Intelligent Inputs -->
      <div class="step active" data-step="0">
        <h2 class="text-xl font-semibold mb-4">Step 1: Filing Information</h2>
        <div class="mb-4">
          <label for="filingStatus" class="block text-sm font-medium text-gray-700">
            Filing Status 
            <span class="text-blue-500 cursor-help" title="Select Single, Married Filing Jointly (MFJ), Married Filing Separately (MFS), or Head of Household (HoH).">?</span>
          </label>
          <select id="filingStatus" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
            <option value="single">Single</option>
            <option value="mfj">Married Filing Jointly</option>
            <option value="mfs">Married Filing Separately</option>
            <option value="hoh">Head of Household</option>
          </select>
        </div>
        
        <!-- ZIP Code & Auto-detect State -->
        <div class="mb-4">
          <label for="zipCode" class="block text-sm font-medium text-gray-700">
            ZIP Code
            <span class="text-blue-500 cursor-help" title="Enter your ZIP code to auto-detect your state.">?</span>
          </label>
          <input type="text" id="zipCode" placeholder="e.g., 90210" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
          <p id="stateAuto" class="mt-1 text-sm text-gray-500"></p>
        </div>
        
        <!-- Self-Employment Option -->
        <div class="mb-4 flex items-center">
          <input type="checkbox" id="selfEmployed" class="mr-2" />
          <label for="selfEmployed" class="text-sm text-gray-700">
            I am self-employed
          </label>
        </div>
        <!-- Business Expense Deductions (shown if self-employed) -->
        <div id="businessExpensesDiv" class="mb-4 hidden">
          <label for="businessExpenses" class="block text-sm font-medium text-gray-700">
            Business Expense Deductions ($)
            <span class="text-blue-500 cursor-help" title="Enter your business expenses if you are self-employed.">?</span>
          </label>
          <input type="number" id="businessExpenses" placeholder="e.g., 5000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        
        <div class="flex justify-end">
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 2: Income, Deductions & OCR Upload -->
      <div class="step" data-step="1">
        <h2 class="text-xl font-semibold mb-4">Step 2: Income & Deductions</h2>
        <div class="mb-4">
          <label for="income" class="block text-sm font-medium text-gray-700">
            Total Income ($)
            <span class="text-blue-500 cursor-help" title="Enter your total income from wages, salaries, tips, etc.">?</span>
          </label>
          <input type="number" id="income" placeholder="e.g., 50000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div class="mb-4">
          <label for="deductions" class="block text-sm font-medium text-gray-700">
            Total Deductions ($)
            <span class="text-blue-500 cursor-help" title="Enter your total deductions (if left blank, the standard deduction is applied).">?</span>
          </label>
          <input type="number" id="deductions" placeholder="e.g., 12000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
          <p class="text-xs text-gray-500 mt-1">Standard deduction will be applied if left blank.</p>
        </div>
        <!-- OCR Upload for W-2, 1099, or pay stub -->
        <div class="mb-4">
          <label for="ocrUpload" class="block text-sm font-medium text-gray-700">
            Upload W‑2/1099/Pay Stub (OCR)
            <span class="text-blue-500 cursor-help" title="Upload a document to auto‑fill income and withholdings.">?</span>
          </label>
          <input type="file" id="ocrUpload" class="mt-1 block w-full" accept=".pdf,.jpg,.png" />
          <p class="text-xs text-gray-500 mt-1">For demo purposes, uploading a file auto‑fills sample values.</p>
        </div>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 3: Withholdings & Dependents -->
      <div class="step" data-step="2">
        <h2 class="text-xl font-semibold mb-4">Step 3: Withholdings & Dependents</h2>
        <div class="mb-4">
          <label for="withholdings" class="block text-sm font-medium text-gray-700">
            Federal Tax Withholdings ($)
            <span class="text-blue-500 cursor-help" title="Enter the total federal tax withheld from your paychecks.">?</span>
          </label>
          <input type="number" id="withholdings" placeholder="e.g., 6000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <div class="mb-4">
          <label for="socialTax" class="block text-sm font-medium text-gray-700">
            Social Security & Medicare Taxes ($)
            <span class="text-blue-500 cursor-help" title="Enter these taxes if available; otherwise, they will be calculated.">?</span>
          </label>
          <input type="number" id="socialTax" placeholder="e.g., 4000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <!-- Dependents Section -->
        <div id="dependentsSection" class="mb-4">
          <label for="numDependents" class="block text-sm font-medium text-gray-700">
            Number of Dependents
            <span class="text-blue-500 cursor-help" title="Select the number of dependents (children or qualifying relatives) you claim.">?</span>
          </label>
          <select id="numDependents" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 4: AMT & Self‑Employment Tax Calculations -->
      <div class="step" data-step="3">
        <h2 class="text-xl font-semibold mb-4">Step 4: AMT & Self‑Employment Tax</h2>
        <div class="mb-4">
          <label for="amtIncome" class="block text-sm font-medium text-gray-700">
            AMT Adjusted Income ($)
            <span class="text-blue-500 cursor-help" title="Enter your AMT adjusted income, if applicable.">?</span>
          </label>
          <input type="number" id="amtIncome" placeholder="e.g., 50000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
        </div>
        <!-- Self‑Employment Tax Section (only if self‑employed is checked) -->
        <div id="seTaxDiv" class="mb-4 hidden">
          <label for="netSEIncome" class="block text-sm font-medium text-gray-700">
            Net Self‑Employment Income ($)
            <span class="text-blue-500 cursor-help" title="Enter your net self‑employment income after business expenses.">?</span>
          </label>
          <input type="number" id="netSEIncome" placeholder="e.g., 40000" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
          <p class="text-xs text-gray-500 mt-1">Self‑Employment Tax (approx. 15.3%) will be calculated on this amount.</p>
        </div>
        <div class="flex justify-between">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 5: Projections, Deductions Optimizer & Recommendations -->
      <div class="step" data-step="4">
        <h2 class="text-xl font-semibold mb-4">Step 5: Projections & Optimizer</h2>
        <div id="recommendations" class="p-4 bg-gray-50 rounded border border-dashed border-gray-300 text-sm text-gray-600">
          <em>Your tailored recommendations will appear here.</em>
        </div>
        <div class="mt-6">
          <label for="incomeProjection" class="block text-sm font-medium text-gray-700">
            Tax Bracket Projection: Adjust Income (% Change)
          </label>
          <input type="range" id="incomeProjection" min="-20" max="20" step="1" value="0" class="w-full mt-2" />
          <p id="projectionText" class="mt-1 text-sm text-gray-600">Current Income Projection: 0% change</p>
          <div id="projectionResult" class="mt-2 p-4 bg-white rounded shadow text-gray-700">
            <!-- Dynamic projection details will appear here -->
            <p>Projected Federal Tax: $0.00</p>
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
          <button type="button" class="nextBtn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Next</button>
        </div>
      </div>
      
      <!-- Step 6: Summary & Actions -->
      <div class="step" data-step="5">
        <h2 class="text-xl font-semibold mb-4">Step 6: Summary & Actions</h2>
        <div id="taxSummary" class="p-4 bg-gray-50 rounded border border-gray-300 text-gray-700">
          <p>Please review your details and calculated tax summary below.</p>
        </div>
        <div class="mt-4 flex flex-col sm:flex-row sm:justify-end gap-2">
          <button type="button" id="printBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Print Summary</button>
          <button type="button" id="exportBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Export Data</button>
        </div>
        <div class="flex justify-start mt-4">
          <button type="button" class="prevBtn bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Back</button>
        </div>
      </div>
      
    </form>
    
    <!-- Disclaimer -->
    <div class="mt-6 text-sm text-gray-600">
      <p>Disclaimer: This estimator is for informational purposes only. Always consult a tax professional for official advice.</p>
      <p class="mt-2 text-red-600 font-bold">Warning: Ensure accuracy to avoid common IRS audit risks.</p>
    </div>
  </div>
  
  <script>
    // ---------- Configuration Data ----------
    const standardDeductions = {
      single: 13850,
      mfj: 27700,
      mfs: 13850,
      hoh: 20800
    };

    const federalTaxBrackets = {
      single: [
        { rate: 0.10, cap: 11000 },
        { rate: 0.12, cap: 44725 },
        { rate: 0.22, cap: 95375 },
        { rate: 0.24, cap: 182100 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 578125 },
        { rate: 0.37, cap: Infinity }
      ],
      mfj: [
        { rate: 0.10, cap: 22000 },
        { rate: 0.12, cap: 89450 },
        { rate: 0.22, cap: 190750 },
        { rate: 0.24, cap: 364200 },
        { rate: 0.32, cap: 462500 },
        { rate: 0.35, cap: 693750 },
        { rate: 0.37, cap: Infinity }
      ],
      mfs: [
        { rate: 0.10, cap: 11000 },
        { rate: 0.12, cap: 44725 },
        { rate: 0.22, cap: 95375 },
        { rate: 0.24, cap: 182100 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 346875 },
        { rate: 0.37, cap: Infinity }
      ],
      hoh: [
        { rate: 0.10, cap: 15700 },
        { rate: 0.12, cap: 59850 },
        { rate: 0.22, cap: 95350 },
        { rate: 0.24, cap: 176250 },
        { rate: 0.32, cap: 231250 },
        { rate: 0.35, cap: 578100 },
        { rate: 0.37, cap: Infinity }
      ]
    };

    // Simplified Flat-State Tax Rates (for demonstration)
    const stateTaxRates = {
      AL: 0.05, AK: 0.00, AZ: 0.045, AR: 0.065, CA: 0.09,
      CO: 0.0463, CT: 0.0699, DE: 0.066, FL: 0.00, GA: 0.0575,
      HI: 0.08, ID: 0.069, IL: 0.05, IN: 0.0323, IA: 0.085,
      KS: 0.057, KY: 0.05, LA: 0.06, ME: 0.0715, MD: 0.0575,
      MA: 0.05, MI: 0.0425, MN: 0.0785, MS: 0.05, MO: 0.054,
      MT: 0.06, NE: 0.0684, NV: 0.00, NH: 0.05, NJ: 0.0637,
      NM: 0.049, NY: 0.0685, NC: 0.0525, ND: 0.022, OH: 0.04997,
      OK: 0.05, OR: 0.09, PA: 0.0307, RI: 0.0599, SC: 0.07,
      SD: 0.00, TN: 0.00, TX: 0.00, UT: 0.0495, VT: 0.08,
      VA: 0.0575, WA: 0.00, WV: 0.065, WI: 0.0765, WY: 0.00
    };

    // ---------- Multi-Step Navigation ----------
    const steps = document.querySelectorAll('.step');
    const indicators = document.querySelectorAll('.step-indicator');
    let currentStep = 0;
    document.querySelectorAll('.nextBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        // If moving from OCR step, process OCR input (simulate)
        if (currentStep === 1) simulateOCR();
        if (currentStep < steps.length - 1) {
          currentStep++;
          updateSteps();
          if (currentStep === 4) updateRecommendations();
          if (currentStep === 5) updateCalculations();
        }
      });
    });
    document.querySelectorAll('.prevBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (currentStep > 0) { currentStep--; updateSteps(); }
      });
    });
    function updateSteps() {
      steps.forEach((step, i) => step.classList.toggle('active', i === currentStep));
      indicators.forEach((ind, i) => ind.classList.toggle('font-bold', i === currentStep));
    }
    
    // ---------- Dynamic Field Visibility ----------
    // Toggle business expense input and self-employment tax section based on checkbox.
    const selfEmpCheckbox = document.getElementById('selfEmployed');
    const businessExpensesDiv = document.getElementById('businessExpensesDiv');
    const seTaxDiv = document.getElementById('seTaxDiv');
    selfEmpCheckbox.addEventListener('change', () => {
      const show = selfEmpCheckbox.checked;
      businessExpensesDiv.classList.toggle('hidden', !show);
      seTaxDiv.classList.toggle('hidden', !show);
    });
    
    // Auto-detect state from ZIP (dummy implementation)
    document.getElementById('zipCode').addEventListener('input', (e) => {
      const zip = e.target.value;
      let state = "";
      // Very basic mapping for demo purposes.
      if (/^90/.test(zip)) state = "CA";
      else if (/^10/.test(zip)) state = "NY";
      else if (/^60/.test(zip)) state = "IL";
      document.getElementById('stateAuto').textContent = state ? `Detected State: ${state}` : "";
    });
    
    // ---------- OCR Simulation ----------
    // For demo: if a file is uploaded, auto-fill sample income & withholdings.
    document.getElementById('ocrUpload').addEventListener('change', simulateOCR);
    function simulateOCR() {
      const fileInput = document.getElementById('ocrUpload');
      if (fileInput.files && fileInput.files.length > 0) {
        // In a real implementation, use an OCR library (e.g., Tesseract.js) or a backend service.
        // For demo, we auto-fill sample values.
        document.getElementById('income').value = 55000;
        document.getElementById('withholdings').value = 6500;
        alert("OCR processed: Sample income ($55,000) and withholdings ($6,500) auto-filled.");
      }
    }
    
    // ---------- Calculation Functions ----------
    function calculateFederalTax(taxableIncome, status) {
      const brackets = federalTaxBrackets[status];
      let tax = 0, prevCap = 0;
      for (const b of brackets) {
        if (taxableIncome > b.cap) {
          tax += (b.cap - prevCap) * b.rate;
          prevCap = b.cap;
        } else {
          tax += (taxableIncome - prevCap) * b.rate;
          break;
        }
      }
      return tax;
    }
    
    // Simplified AMT calculation (26% up to threshold, then 28%)
    function calculateAMT(amtIncome) {
      if (amtIncome <= 220700) return amtIncome * 0.26;
      return (220700 * 0.26) + ((amtIncome - 220700) * 0.28);
    }
    
    // FICA calculation (Social Security & Medicare)
    function calculateFICA(income) {
      const wageBase = 160200;
      const ssTax = Math.min(income, wageBase) * 0.062;
      const medicare = income * 0.0145;
      return ssTax + medicare;
    }
    
    // Self‑Employment Tax: approx. 15.3% of net SE income.
    function calculateSelfEmploymentTax(netSEIncome) {
      return netSEIncome * 0.153;
    }
    
    // ---------- Tax Bracket Projection ----------
    const incomeProjectionInput = document.getElementById('incomeProjection');
    incomeProjectionInput.addEventListener('input', updateProjection);
    function updateProjection() {
      const changePercent = parseInt(incomeProjectionInput.value);
      document.getElementById('projectionText').textContent = `Current Income Projection: ${changePercent}% change`;
      const baseIncome = parseFloat(document.getElementById('income').value) || 0;
      const projectedIncome = baseIncome * (1 + changePercent / 100);
      const filingStatus = document.getElementById('filingStatus').value;
      const deductionsInput = parseFloat(document.getElementById('deductions').value);
      const deductionValue = deductionsInput && deductionsInput > 0 ? deductionsInput : standardDeductions[filingStatus];
      const taxableProjected = Math.max(projectedIncome - deductionValue, 0);
      const projFederalTax = calculateFederalTax(taxableProjected, filingStatus);
      document.getElementById('projectionResult').innerHTML = `<p>Projected Federal Tax for $${projectedIncome.toFixed(2)} income: $${projFederalTax.toFixed(2)}</p>`;
    }
    
    // ---------- Recommendations & Deductions Optimizer ----------
    function updateRecommendations() {
      const income = parseFloat(document.getElementById('income').value) || 0;
      let deductions = parseFloat(document.getElementById('deductions').value);
      const filingStatus = document.getElementById('filingStatus').value;
      const recDiv = document.getElementById('recommendations');
      const standard = standardDeductions[filingStatus] || 0;
      let recs = [];
      if (!deductions || deductions < standard) {
        recs.push(`Consider taking the standard deduction of $${standard} rather than itemizing.`);
      } else {
        recs.push("Your itemized deductions exceed the standard deduction.");
      }
      if (income < 50000 && filingStatus === "single") {
        recs.push("You may be eligible for the Earned Income Tax Credit.");
      }
      recs.push("Review eligibility for credits such as the Child Tax Credit.");
      if (deductions > income * 0.8) {
        recs.push("<span class='text-red-600 font-bold'>Audit Risk Warning:</span> Deductions unusually high relative to income.");
      }
      recDiv.innerHTML = recs.map(r => `<p>${r}</p>`).join('');
      // Update projection in case income/deductions changed.
      updateProjection();
    }
    
    // ---------- Main Calculation & Summary ----------
    function updateCalculations() {
      const filingStatus = document.getElementById('filingStatus').value;
      let deductions = parseFloat(document.getElementById('deductions').value);
      const income = parseFloat(document.getElementById('income').value) || 0;
      const withholdings = parseFloat(document.getElementById('withholdings').value) || 0;
      const socialTaxInput = parseFloat(document.getElementById('socialTax').value) || 0;
      const amtIncome = parseFloat(document.getElementById('amtIncome').value) || 0;
      // Apply standard deduction if none provided.
      if (!deductions || deductions < 1) { 
        deductions = standardDeductions[filingStatus] || 0; 
      }
      // Business expenses (if self-employed) reduce taxable income.
      const businessExpenses = parseFloat(document.getElementById('businessExpenses').value) || 0;
      const adjustedIncome = income - businessExpenses;
      const taxableIncome = Math.max(adjustedIncome - deductions, 0);
      const federalTax = calculateFederalTax(taxableIncome, filingStatus);
      const amtTax = amtIncome > 0 ? calculateAMT(amtIncome) : 0;
      const totalFederalTax = Math.max(federalTax, amtTax);
      const ficaTax = socialTaxInput || calculateFICA(income);
      let seTax = 0;
      if (selfEmpCheckbox.checked) {
        const netSEIncome = parseFloat(document.getElementById('netSEIncome').value) || 0;
        seTax = calculateSelfEmploymentTax(netSEIncome);
      }
      // Dependents credit: For demo purposes, assume $2000 per dependent.
      const creditPerDependent = 2000;
      const numDependents = parseInt(document.getElementById('numDependents').value) || 0;
      const dependentCredit = numDependents * creditPerDependent;
      
      // Auto-detect state tax rate: if ZIP code auto-detected state available, override state from ZIP.
      let stateCode = "";
      const detectedStateText = document.getElementById('stateAuto').textContent;
      if (detectedStateText.includes("Detected State:")) {
        stateCode = detectedStateText.replace("Detected State: ", "").trim();
      }
      let stateTax = 0;
      if (stateCode && stateTaxRates[stateCode]) {
        stateTax = taxableIncome * stateTaxRates[stateCode];
      }
      
      const totalTaxLiability = totalFederalTax + stateTax + ficaTax + seTax;
      const adjustedTaxLiability = totalTaxLiability - dependentCredit;
      const refundOrOwed = withholdings - adjustedTaxLiability;
      
      // Build summary HTML.
      let summary = `<p><strong>Taxable Income:</strong> $${taxableIncome.toFixed(2)}</p>`;
      summary += `<p><strong>Federal Tax:</strong> $${federalTax.toFixed(2)}</p>`;
      if (amtTax > federalTax) { 
        summary += `<p class="text-orange-600"><strong>AMT Applied:</strong> $${amtTax.toFixed(2)}</p>`; 
      }
      summary += `<p><strong>State Tax:</strong> $${stateTax.toFixed(2)}</p>`;
      summary += `<p><strong>FICA (Social Security & Medicare):</strong> $${ficaTax.toFixed(2)}</p>`;
      if (selfEmpCheckbox.checked) { 
        summary += `<p><strong>Self‑Employment Tax:</strong> $${seTax.toFixed(2)}</p>`; 
      }
      summary += `<p><strong>Dependent Credit:</strong> -$${dependentCredit.toFixed(2)}</p>`;
      summary += `<p class="mt-2 border-t pt-2"><strong>Total Tax Liability after Credits:</strong> $${adjustedTaxLiability.toFixed(2)}</p>`;
      
      if (refundOrOwed >= 0) {
        summary += `<p class="mt-2 text-green-600 font-bold">Expected Refund: $${refundOrOwed.toFixed(2)}</p>`;
      } else {
        summary += `<p class="mt-2 text-red-600 font-bold">Tax Owed: $${Math.abs(refundOrOwed).toFixed(2)}</p>`;
      }
      document.getElementById('taxSummary').innerHTML = summary;
    }
    
    // ---------- Real-Time Updates ----------
    document.querySelectorAll('#taxForm input, #taxForm select').forEach(el => {
      el.addEventListener('input', () => {
        if (currentStep === 5) updateCalculations();
        if (currentStep === 4) updateRecommendations();
      });
      el.addEventListener('change', () => {
        if (currentStep === 5) updateCalculations();
        if (currentStep === 4) updateRecommendations();
      });
    });
    
    // ---------- Print & Export Functionality ----------
    document.getElementById('printBtn').addEventListener('click', () => window.print());
    document.getElementById('exportBtn').addEventListener('click', () => {
      const data = {
        filingStatus: document.getElementById('filingStatus').value,
        zipCode: document.getElementById('zipCode').value,
        selfEmployed: selfEmpCheckbox.checked,
        businessExpenses: document.getElementById('businessExpenses').value,
        income: document.getElementById('income').value,
        deductions: document.getElementById('deductions').value,
        withholdings: document.getElementById('withholdings').value,
        socialTax: document.getElementById('socialTax').value,
        amtIncome: document.getElementById('amtIncome').value,
        netSEIncome: document.getElementById('netSEIncome').value,
        numDependents: document.getElementById('numDependents').value
      };
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
      const a = document.createElement("a");
      a.setAttribute("href", dataStr);
      a.setAttribute("download", "tax_data.json");
      a.click();
    });
  </script>
</body>
</html>
